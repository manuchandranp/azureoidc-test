steps:
- task: JfrogCliV2@1
  name: jfrogExport
  inputs:
    jfrogPlatformConnection: 'hts2'
    # We run the command directly through the JFrog task
    command: 'jf c export --format=json'

- powershell: |
    # The output of the previous JFrog task is stored in this variable
    $jsonConfig = '$(jfrogExport.CliOutput)'
    
    if ($jsonConfig) {
        $config = $jsonConfig | ConvertFrom-Json
        $token = $config.accessToken
        
        Write-Host "Token successfully retrieved."
        
        # To print it without Azure masking it as ***, we hex-encode it.
        # You can then decode this hex string online or in a terminal.
        $hex = ($token.ToCharArray() | ForEach-Object { [System.Convert]::ToString([int]$_, 16).PadLeft(2, '0') }) -join ''
        Write-Host "Hex-Encoded Token: $hex"
    } else {
        Write-Error "No output captured from JFrog task."
    }
  displayName: 'Extract and Print Full Token'