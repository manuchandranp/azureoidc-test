steps:
- task: JfrogCliV2@1
  name: jfrogSetup
  inputs:
    jfrogPlatformConnection: 'hts2'
    command: 'jf rt ping' # Triggers the OIDC handshake and saves config

- bash: |
    # 1. Locate the jf binary (using the path from your error log)
    JF_PATH="/opt/hostedtoolcache/jf/2.89.0/x64/jf"
    
    # 2. Use 'show' to get the current config in clear text
    # We grab the 'accessToken' line specifically
    TOKEN=$($JF_PATH c show --format json | grep -oP '(?<="accessToken": ")[^"]*')
    
    if [ -z "$TOKEN" ]; then
      echo "Token not found in config. Ensure the OIDC connection succeeded."
      exit 1
    fi
    
    echo "Token successfully captured."
    
    # 3. Print the token in Hex to bypass the Azure log masking
    echo -n "$TOKEN" | xxd -p | tr -d '\n'
    echo ""
    echo "--- Done ---"
  displayName: 'Extract and Hex-Print Token'