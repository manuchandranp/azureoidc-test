steps:
- task: JfrogCliV2@1
  name: jfrogStep
  inputs:
    jfrogPlatformConnection: 'hts2'
    # Use 'c export' to force the CLI to show its configuration
    command: 'jf c export' 

- powershell: |
    # This checks if the variable exists in the environment at all
    if ($env:TOKEN) {
        Write-Host "Token found. Length: $($env:TOKEN.Length)"
        # To see the token despite masking, we base64 encode it 
        # (Only do this for temporary debugging!)
        $Bytes = [System.Text.Encoding]::UTF8.GetBytes($env:TOKEN)
        $Encoded = [Convert]::ToBase64String($Bytes)
        Write-Host "Base64 Token: $Encoded"
    } else {
        Write-Error "Variable jfrogStep.oidc_token is NULL. The OIDC handshake failed."
    }
  env:
    TOKEN: $(jfrogStep.oidc_token)
  displayName: 'Debug Token Availability'