steps:
- task: JfrogCliV2@1
  name: jfrogStep
  inputs:
    jfrogPlatformConnection: 'hts2'
    command: 'jf rt ping' # This triggers the OIDC exchange

- powershell: |
    # 1. Capture the full config from the CLI
    $jfConfig = jf c export --format=json | ConvertFrom-Json
    
    # 2. Extract the access token
    $token = $jfConfig.accessToken
    
    if ($token) {
        Write-Host "Token successfully captured!"
        
        # 3. Print the full token (Azure will likely mask this as ***)
        Write-Host "Raw Token: $token"
        
        # 4. Print Base64 of the ACTUAL token so you can decode it elsewhere
        $Bytes = [System.Text.Encoding]::UTF8.GetBytes($token)
        $Encoded = [Convert]::ToBase64String($Bytes)
        Write-Host "Base64 of Actual Token: $Encoded"
    } else {
        Write-Error "Could not find accessToken in JFrog config. Check Service Connection logs."
    }
  displayName: 'Extract and Print Full Token'